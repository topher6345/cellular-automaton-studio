<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script id="2d-vertex-shader" type="x-shader/x-vertex">
      // Vertext Shader
      // ==============
      //

      // NEWB:
      //    attribute
      //    (variable qualifier)

      attribute vec2 a_position;

      //    http://www.shaderific.com/glsl-qualifiers
      //
      // qualifier declares variables shared between a *vertex* shader
      // and the OpenGL ES environment.
      // Since the vertex shader is executed one time for each vertex, attributes
      // specify per vertex data, providing data such as:
      // * the object space position
      // * the normal direction
      // * the texture coordinates of a vertex.
      // Attributes are read-only variables, i.e.
      // their value can not be changed in the vertex shader.
      // Side note: Since an attribute is never initialized in the shader it
      // has to be loaded with data by the application executing the shader.


      // NEWB:
      //    uniform
      //    (variable qualifier)

      uniform float u_flipY;

      // The qualifier uniform is used to declare variables that are
      // shared between a shader and the OpenGL ES environment.

      // Uniforms can be used in the vertex shader and the fragment
      // shader and they must have global scope. The same uniform variable
      // can be used in the vertex and the fragment shader, but since
      // both shaders share the same namespace the declaration has to
      // be identical. Uniforms are used to specify properties of the
      // object that is rendered. Examples are the projection matrix, the
      // light position or the material color of the object. Uniforms are
      // read-only variables, i.e. their value can not be changed in the shader.
      // Side note: Since a uniform is never initialized in the shader it
      // has to be loaded with data by the application executing the shader.


      // assigned in main as v_texCoord = a_texCoord;
      attribute vec2 a_texCoord;
      varying vec2 v_texCoord;

      void main() {
        // NEWB:
        //   gl_Position
        //   (built-in variable)

         gl_Position = vec4(a_position.x, u_flipY*a_position.y, 0, 1);

        // The built-in variable gl_Position is used by the vertex shader to
        // hand over the transformed vertex position to the OpenGL ES 2.0 pipeline.
        // The variable is declared as shown above and can be used in the vertex shader
        // for an assignment without prior declaration.
        // The values of the position vector are interpreted in clip coordinate space.
        // The vertex shader is responsible to execute all vertex manipulations, e.g.
        // the transformation from object coordinates to clip coordinates.
        // The assignment of values to this variable is mandatory for the vertex shader.


         v_texCoord = a_texCoord;
      }
    </script>

    <script id="2d-fragment-shader" type="x-shader/x-fragment">
      precision mediump float;

      uniform sampler2D u_image;//texture array

      varying vec2 v_texCoord;
      uniform vec2 u_textureSize;

      uniform vec2 u_mouseCoord;

      void main() {

          vec2 onePixel = vec2(1.0, 1.0)/u_textureSize;

          vec2 pxDistFromMouse = (v_texCoord - u_mouseCoord)*(v_texCoord - u_mouseCoord)/onePixel;

          float tol = 0.005;
          if (pxDistFromMouse.x < tol && pxDistFromMouse.y < tol){
              gl_FragColor = vec4(1.0,1.0,1.0,1);
              return;
          }



          vec4 rawTextureData = texture2D(u_image, v_texCoord);

          int count = 0;
          for (int i=-1;i<2;i++){
              for (int j=-1;j<2;j++){
                  if (i == 0 && j == 0) continue;
                  vec2 neighborCoord = v_texCoord + vec2(onePixel.x*float(i), onePixel.y*float(j));
                  if (vec4(texture2D(u_image, neighborCoord)).r == 1.0) count++;
              }
          }


          if (count == 3) {
              gl_FragColor = vec4(1.0,1.0,1.0,1);
              return;
          }
          if (rawTextureData.x == 1.0 && count == 2){
              gl_FragColor = vec4(1.0,0.0,1.0,1);
              return;
          }
          gl_FragColor = vec4(0,0,0,1);
      }
    </script>
    <link href="styles.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <canvas id="glcanvas"></canvas>
    <div id="root">
      <div id="modal-capture">
        <div id="modal-capture-preview"></div>
      </div>

      <div class="controls">
        <div>
          <h1>Cellular Automaton Studio</h1>
          <a href="https://github.com/topher6345">@topher6345</a>
        </div>
        <div>
          <label
            for="masterOn"
            title="When selected, the simulation is animating"
            >On</label
          >
          <input type="radio" id="masterOn" name="master" value="on" checked />
          <label
            for="masterOff"
            title="When selected, the simulation is not animating."
            >Off</label
          >
          <input type="radio" id="masterOff" name="master" value="off" />
        </div>

        <div>
          <label
            for="gameType"
            title="When selected, the simulation is not animating."
            >Game</label
          >
          <select name="gameType" id="gameType">
            <option value="life" selected>Life</option>
            <option value="highlife">High Life</option>
            <option value="replicator">Replicator</option>
            <option value="seeds">Seeds</option>
            <option value="B25/S4">B25/S4</option>
            <option value="34life">34 Life</option>
            <option value="diamoeba">Diamoeba</option>
            <option value="2x2">2x2</option>
            <option value="day&night">Day & Night</option>
            <option value="morley">morley</option>
            <option value="anneal">anneal</option>
            <option value="famine">famine</option>
          </select>
        </div>
        <div>
          <label
            title="Blur only partially erases each frame, leaving visual trails"
            for="blurOn"
            >Blur</label
          >
          <input type="radio" id="blurOn" name="radio" value="on" checked />

          <label title="Each new frame is drawn over the last" for="blurOff"
            >Overlay</label
          >
          <input type="radio" id="blurOff" name="radio" />

          <label
            title="Each frame is erased and redrawn from scratch"
            for="blurEnabled"
            >Clear Frame</label
          >
          <input title="clearFrame" name="radio" type="radio" id="clearFrame" />
          <label
            title="Blur Amount: left is more blur and longer trails, right is less blur and shorter trails."
            for="motion-blur"
            >Blur Amount
          </label>
          <input
            name="motion-blur"
            type="range"
            id="delay"
            min="0.0001"
            max="0.3"
            step="0.0001"
            value="0.0005"
          />
        </div>
        <div>
          <label
            title="Blend Mode: the compositing or blending operation used in blending the new frame with the old."
            for="setBlendMode"
            >Blend Mode</label
          >
          <select name="setBlendMode">
            <option value="source-over">source-over</option>
            <!-- <option value="source-in">source-in</option>
            <option value="source-out">source-out</option> -->
            <option value="source-atop">source-atop</option>
            <!-- <option value="destination-over">destination-over</option> -->
            <!-- <option value="destination-in">destination-in</option> -->
            <!-- <option value="destination-out">destination-out</option> -->
            <!-- <option value="destination-atop">destination-atop</option> -->
            <option value="lighter">lighter</option>
            <!-- <option value="copy">copy</option> -->
            <option value="xor">xor</option>
            <option value="multiply">multiply</option>
            <option value="screen">screen</option>
            <option value="overlay">overlay</option>
            <option value="darken">darken</option>
            <option value="lighten">lighten</option>
            <option value="color-dodge">color-dodge</option>
            <option value="color-burn">color-burn</option>
            <option value="hard-light">hard-light</option>
            <option value="soft-light">soft-light</option>
            <option value="difference">difference</option>
            <option value="exclusion">exclusion</option>
            <option value="hue">hue</option>
            <option value="saturation">saturation</option>
            <option value="luminosity">luminosity</option>
          </select>
        </div>
        <div>
          <label title="Speed - left is faster, right is slower" for="rate"
            >Speed</label
          >
          <input type="range" name="rate" id="rate" min="17" max="250" />
        </div>

        <div>
          <label
            title="Screenshot: Take as screenshot of the canvas for downloading as a .png file."
            >Screenshot</label
          >
          <button id="screencap">ðŸ“·</button>
        </div>
        <div>
          <label title="Redraw: Add or remove cells in the simluation"
            >Redraw</label
          >
          <button id="reset">Random</button>
          <button id="clear">Clear</button>
        </div>
        <div>
          <label
            title="Click Shape: the shape of new live cells in the animation when you click"
            for="setShape"
            >Click Shape</label
          >
          <select name="setShape" id="setShape">
            <option value="gliderse">Glider SE</option>
            <option value="3x3">3x3</option>
          </select>
        </div>
        <div>
          <label
            title="When checked, hovering the mouse over the canvas will draw a pixel"
            for="hover"
            >Hover On</label
          >
          <input title="Hover" name="hover" type="radio" id="hoverOn" />
          <label
            title="When checked, hovering the mouse over the canvas will draw a pixel"
            for="hover"
            >Hover Off</label
          >
          <input
            title="Hover"
            name="hover"
            type="radio"
            id="hoverOff"
            checked
          />
        </div>
        <div>
          <label
            title="Color Mode: Different options for how new colors appear in the animation"
            for="colorMode"
            >Color Mode</label
          >
          <select name="colorMode" id="colorMode">
            <option value="picker">Color Picker</option>
            <option value="full" selected>Random Frame</option>
            <option value="row">Random Row</option>
            <option value="each">Random Pixel</option>
          </select>
          <label
            title="Color Range: Breadth of the random colors, left is fewer colors, right is more colors"
            for="colorRadix"
            >Color Range</label
          >
          <input
            name="colorRadix"
            id="colorRadix"
            type="range"
            min="1"
            max="16777215"
            value="16777215"
          />
          <label
            title="Color Rate: How quickly a new random color is chosen, left is less often, right is more often"
            for="randCycle"
            >Color Rate</label
          >
          <input
            name="randCycle"
            type="range"
            min="1"
            max="500"
            id="randCycle"
            value="1000"
          />
          <label
            style="display: none;"
            title="The color of the new pixels."
            for="color"
            >Picker</label
          >
          <input
            style="display: none;"
            type="color"
            id="color"
            name="color"
            value="#e66465"
          />
        </div>
        <div id="record">
          <label
            title="Recording: This will start recording video, automatically stops after 30 seconds"
            for="record-video"
            >Recording</label
          >
          <input type="radio" id="recStart" name="record-video" />
          <label
            title="Stop the currently recording video and open the gallery"
            for="record-video"
            >Stopped</label
          >
          <input type="radio" id="recStop" name="record-video" checked />
        </div>
        <div id="noise">
          <label title="Adds random live cells to the simulation" for="noiseOn"
            >Noise On</label
          >
          <input type="radio" id="noiseOn" name="noise" />

          <label
            title="Disables random live cells in the simulation"
            for="noiseOff"
            >Noise Off</label
          >
          <input type="radio" id="noiseOff" name="noise" checked />
          <label
            title="How likely live cells spontaneously appear"
            for="noiseRangeValue"
            >Amount</label
          >
          <input
            name="noiseRangeValue"
            type="range"
            min="0"
            max="15"
            id="noiseRangeValue"
            value="0"
            disabled=""
          />
        </div>
      </div>
      <script src="index.js"></script>
    </div>
  </body>
</html>
